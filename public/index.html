<!DOCTYPE html>
<html lang="en">
  <head>
  <!-- 1) Load the Firebase SDKs first -->
  <script src="https://www.gstatic.com/firebasejs/12.0.0/firebase-app.js"></script>
  <script src="https://www.gstatic.com/firebasejs/12.0.0/firebase-auth.js"></script>
  </head>head>
  <meta charset="UTF-8"/>
  <meta name="viewport" content="width=device-width, initial-scale=1.0"/>
  <title>The FanMoon</title>
  <style>
    </head>
    <body>
    /* ─────────── Page & Button Reset ─────────── */
    * { box-sizing: border-box; margin:0; padding:0; }
    html { font-size:16px; }
    body {
      background: #181828;
      color: #fff;
      font-family: 'Segoe UI', sans-serif;
      text-align: center;
      padding: 24px 0;
    }

    /* ─────────── Fanmoon Container ─────────── */
    #fanmoon {
      width: 200px;
      height: 200px;
      margin: 0 auto 24px;
      border-radius: 50%;
      position: relative;
      background: #000;
      overflow: hidden;
      /* golden halo */
      box-shadow:
        inset 0 10px 30px rgba(0,0,0,0.7),
        0 0 60px rgba(255,215,0,0.4);
    }
    /* pastel purple/pink/blue blobs + noise */
    #fanmoon.huntrix-win {
      background:
        repeating-linear-gradient(45deg,
          rgba(255,255,255,0.05) 0px,
          rgba(255,255,255,0.05) 1px,
          transparent 2px,
          transparent 3px
        ) 0 0/3px 3px,
        radial-gradient(circle at 30% 30%, rgba(180,120,255,0.6), transparent 60%),
        radial-gradient(circle at 70% 40%, rgba(255,120,200,0.6), transparent 60%),
        radial-gradient(circle at 50% 70%, rgba(120,200,255,0.6), transparent 60%);
      background-blend-mode: screen;
      filter: blur(8px) contrast(1.1) saturate(0.9);
    }

    /* ─────────── Glossy Highlight ─────────── */
    #fanmoon.huntrix-win::before {
      content: "";
      position: absolute; inset: 0;
      pointer-events: none;
      background: radial-gradient(circle at 30% 30%,
        rgba(255,255,255,0.3),
        transparent 60%
      );
      mix-blend-mode: screen;
      opacity: 0.4;
      z-index: 1;
    }

    /* ─────────── Blue Ripple Lines ─────────── */
    #fanmoon.huntrix-win::after {
      content: "";
      position: absolute; inset: 0;
      pointer-events: none;
      background: url("data:image/svg+xml;utf8,\
<svg xmlns='http://www.w3.org/2000/svg' viewBox='0 0 200 200'>\
  <path d='M0,80 C40,60 80,100 120,90 S180,80 200,75' stroke='%2300d4ff' stroke-width='3' fill='none' opacity='0.4'/>\
  <path d='M0,110 C50,90 100,140 150,110 S200,95 200,95' stroke='%2300d4ff' stroke-width='2' fill='none' opacity='0.3'/>\
  <path d='M0,135 C40,115 120,150 180,130 S200,120 200,120' stroke='%2300d4ff' stroke-width='1' fill='none' opacity='0.2'/>\
</svg>") center/contain no-repeat;
      mix-blend-mode: screen;
      filter: blur(3px);
      z-index: 2;
    }

    /* ─────────── SVG Noise Filter ─────────── */
    svg#noise-defs { position:absolute; width:0; height:0; }
    svg#noise-defs filter feTurbulence { baseFrequency:3; numOctaves:2; }
    svg#noise-defs filter feColorMatrix { values: 1 0 0 0 0  0 1 0 0 0  0 0 1 0 0  0 0 0 0.3 0; }

    /* ─────────── Voting UI & Counts ─────────── */
    .vote-ui {
      display: flex; justify-content: center;
      gap: 1.5rem; margin-bottom: 0.5rem;
    }
    .vote-btn {
      font-size: 1rem; padding: 0.75rem 1.5rem;
      border: none; border-radius: 2rem;
      font-weight:700; cursor:pointer;
      transition: transform .1s, box-shadow .1s;
      box-shadow:0 2px 12px #0004; outline:none;
    }
    .vote-btn:active { transform:scale(0.95); }
    .vote-btn.saja {
      background:linear-gradient(90deg,#ff46c7,#e00047);
      color:#fff; text-shadow:0 1px 3px #e0004780;
    }
    .vote-btn.huntrix {
      background:linear-gradient(90deg,#b6fff7,#e2c4ff,#ffe5ec);
      color:#4b3585; text-shadow:0 1px 3px #fff8;
    }

    .vote-counts {
      font-size:1rem; font-weight:600;
      display:flex; justify-content:center; gap:2rem;
      margin-bottom:1.5rem;
    }
    .vote-counts .saja { color:#ff46c7; }
    .vote-counts .huntrix { color:#3dd8ff; }
  </style>

  <!-- SVG filter for noise -->
  <svg id="noise-defs">
    <filter id="pastelNoise">
      <feTurbulence type="fractalNoise" stitchTiles="stitch"/>
      <feColorMatrix type="matrix"/>
      <feComposite in2="SourceGraphic" operator="over"/>
    </filter>
  </svg>
</head>

<body>
  <h1>The FanMoon</h1>

  <!-- THE ORB -->
  <div id="fanmoon" class="huntrix-win"></div>

  <!-- BUTTONS -->
  <div class="vote-ui">
    <button id="vote-saja"    class="vote-btn saja">Vote Saja Boys</button>
    <button id="vote-huntrix" class="vote-btn huntrix">Vote Huntr/x</button>
  </div>

  <!-- COUNTERS -->
  <div class="vote-counts">
    <div class="saja">Saja Boys: <span id="saja-count">0</span></div>
    <div class="huntrix">Huntr/x: <span id="huntrix-count">0</span></div>
  </div>

  <!-- ─────────── Firebase + Vote Logic ─────────── -->
 <script type="module">
  import { initializeApp } from "https://www.gstatic.com/firebasejs/12.0.0/firebase-app.js";
  import { getAuth, signInAnonymously } from "https://www.gstatic.com/firebasejs/12.0.0/firebase-auth.js";

  // 1) Init Firebase
  const firebaseConfig = {
    apiKey: "YOUR_FIREBASE_API_KEY",
    authDomain: "YOUR_PROJECT.firebaseapp.com",
    projectId: "YOUR_PROJECT_ID",
  };
  initializeApp(firebaseConfig);
  const auth = getAuth();

  // 2) Helpers to call your new API
  async function callVoteAPI(method, body) {
    const user = auth.currentUser;
    if (!user) throw new Error("Not signed in");
    const token = await user.getIdToken();
    const res = await fetch("/api/vote", {
      method,
      headers: {
        "Content-Type": "application/json",
        "Authorization": "Bearer " + token,
      },
      body: body ? JSON.stringify(body) : undefined,
    });
    return res.json();
  }

  // 3) UI update functions
  const fan = document.getElementById("fanmoon");
  const btnS = document.getElementById("vote-saja");
  const btnH = document.getElementById("vote-huntrix");
  const elS  = document.getElementById("saja-count");
  const elH  = document.getElementById("huntrix-count");

  function refreshDisplay(vote) {
    // highlight orb
    fan.className = "";
    if (vote === "saja") fan.classList.add("saja-win");
    else if (vote === "huntrix") fan.classList.add("huntrix-win");

    // show just the user’s vote count (we’ll handle global counts later)
    elS.textContent = vote === "saja"    ? "1" : "0";
    elH.textContent = vote === "huntrix" ? "1" : "0";
  }

  // 4) Sign in & load initial vote
  signInAnonymously(auth)
    .then(async () => {
      // fetch the user’s current vote
      const { vote } = await callVoteAPI("GET");
      refreshDisplay(vote);

      // wire up buttons
      btnS.onclick = async () => {
        await callVoteAPI("POST", { choice: "saja" });
        refreshDisplay("saja");
      };
      btnH.onclick = async () => {
        await callVoteAPI("POST", { choice: "huntrix" });
        refreshDisplay("huntrix");
      };
    })
    .catch(console.error);
</script>


